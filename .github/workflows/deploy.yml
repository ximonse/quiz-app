name: Deploy via SFTP
on:
  push:
    branches: ["main"]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install lftp
        run: sudo apt-get update && sudo apt-get install -y lftp
      - name: Deploy
        env:
          SFTP_HOST: ${{ secrets.SFTP_HOST }}
          SFTP_USER: ${{ secrets.SFTP_USER }}
          SFTP_PASS: ${{ secrets.SFTP_PASS }}
          SFTP_PORT: ${{ secrets.SFTP_PORT }}
        run: |
          lftp -c "
            set sftp:auto-confirm yes;
            open -u $SFTP_USER,$SFTP_PASS sftp://$SFTP_HOST:$SFTP_PORT;
            mirror -R --verbose \
              --exclude-glob .git* \
              --exclude-glob .github/ \
              --exclude-glob data/*.json \
              --exclude-glob data/images/ \
              --exclude-glob backup-*/ \
              --exclude-glob .claude/ \
              ./ /customers/a/b/a/ximon.se/httpd.www/quiz-app/
          "